Source: oahong@gmail.com (qt4 immodule fix partially based upon Debian patch)
Upstream: No
Reason: various fixes for automagic dependencies and Qt4 libdir/immodule
diff -U 3 -H -b -w -B -E -d -i -r -N -- gcin-1.4.5.pre2.orig/configure gcin-1.4.5.pre2/configure
--- gcin-1.4.5.pre2.orig/configure	2009-02-01 15:00:40.000000000 +0800
+++ gcin-1.4.5.pre2/configure	2009-04-15 03:46:17.000000000 +0800
@@ -39,6 +39,9 @@
 use_tray='Y'
 use_i18n='N'
 use_tsin='Y'
+use_anthy='N'
+qt4_im='N'
+qt3_im='N'
 
 if [ "$GCIN_USE_XIM" ]; then
   use_xim=$GCIN_USE_XIM
@@ -58,6 +61,11 @@
   ;;
   --use_tsin=*) use_tsin=`echo $opt | cut -d '=' -f 2`
   ;;
+  --use_anthy*) use_anthy=`echo $opt | cut -d '=' -f 2`
+  ;;
+  --qt3_im*) qt3_im=`echo $opt | cut -d '=' -f 2`
+  ;;
+  --qt4_im*) qt4_im=`echo $opt | cut -d '=' -f 2`
   esac
 done
 
@@ -114,9 +122,14 @@
   USE_ANTHY=N
   echo "It's ok if you don't want anthy support."
 else
+  if [[ $use_anthy == "N" ]] ; then
+      USE_ANTHY=N
+      echo "disabled."
+  else
   USE_ANTHY=Y
   echo "found."
 fi
+fi
 
 LIB='lib'
 if [ -d /lib64 ]; then
@@ -124,9 +137,9 @@
 fi
 
 QT_IM='N'
-QT_IM_DIR=/usr/lib/qt3/plugins/lib/inputmethods
+QT_IM_DIR=/usr/$LIB/qt3/plugins/inputmethods
 echo "testing if you have qt3 support"
-if [ -d  $QT_IM_DIR ]; then
+if [ -d  $QT_IM_DIR ] && [[ $qt3_im = "Y" ]]; then
   QT_IM='Y'
 fi
 
@@ -138,14 +151,19 @@
 
 
 QT4_IM='N'
-QT4_IM_DIR=/usr/lib/qt4/plugins/lib/inputmethods
+QT4_IM_DIR=/usr/$LIB/qt4/plugins/inputmethods
 echo "testing if you have qt4 support"
 if [ -d  $QT4_IM_DIR ]; then
   QT4_IM='Y'
 fi
 
 if [ $QT4_IM = "Y" ]; then
+    if [[ $qt4_im = "N" ]] ; then
+        QT4_IM='N'
+        echo "-> Yes, but disabled"
+    else
     echo "-> Yes, you have qt4 support"
+    fi
 else
     echo "-> No, you don't have. It's ok if you don't want QT support."
 fi
@@ -183,10 +201,10 @@
 fi
 
 
-OPTFLAGS="-g"
-if [ $prefix = /usr ]; then
-  OPTFLAGS="-O"
-fi
+OPTFLAGS=""
+#if [ $prefix = /usr ]; then
+#  OPTFLAGS="-O"
+#fi
 
 
 echo "CC=gcc" > config.mak
@@ -213,9 +231,9 @@
 echo "OPTFLAGS=$OPTFLAGS" >> config.mak
 echo "DOC_DIR=\$(datadir_r)/doc/gcin-$GCIN_VERSION" >> config.mak
 echo "DOC_DIR_i=\$(datadir)/doc/gcin-$GCIN_VERSION" >> config.mak
-echo "GCIN_ICON_DIR=\$(datadir_r)/icons/gcin" >> config.mak
-echo "SYS_ICON_DIR=\$(datadir_r)/icons" >> config.mak
-echo "GCIN_ICON_DIR_i=\$(datadir)/icons/gcin" >> config.mak
+echo "GCIN_ICON_DIR=\$(datadir_r)/pixmaps/gcin" >> config.mak
+echo "SYS_ICON_DIR=\$(datadir_r)/pixmaps" >> config.mak
+echo "GCIN_ICON_DIR_i=\$(datadir)/pixmaps/gcin" >> config.mak
 echo "GCIN_BIN_DIR=\$(bindir_r)" >> config.mak
 echo "FREEBSD=$FREEBSD" >> config.mak
 echo "QT_IM=$QT_IM" >> config.mak
diff -U 3 -H -b -w -B -E -d -i -r -N -- gcin-1.4.5.pre2.orig/Makefile gcin-1.4.5.pre2/Makefile
--- gcin-1.4.5.pre2.orig/Makefile	2009-02-28 15:43:27.000000000 +0800
+++ gcin-1.4.5.pre2/Makefile	2009-04-15 02:44:24.000000000 +0800
@@ -213,8 +213,8 @@
 	install $(GCIN_SO) $(gcinlibdir)
 
 install:
-	install -d $(datadir)/icons
-	install gcin.png $(datadir)/icons
+	install -d $(datadir)/pixmaps
+	install gcin.png $(datadir)/pixmaps
 	$(MAKE) -C icons install
 	install -d $(gcinlibdir)
 	install $(GCIN_SO) $(gcinlibdir)
@@ -225,7 +225,7 @@
 	if [ $(QT_IM) = 'Y' ]; then $(MAKE) -C qt-im install; fi
 	if [ $(QT4_IM) = 'Y' ]; then $(MAKE) -C qt4-im install; fi
 	if [ $(prefix) = /usr/local ]; then \
-	   install -m 644 gcin.png /usr/share/icons; \
+	   install -m 644 gcin.png /usr/share/pixmaps; \
 	   install -d $(DOC_DIR); \
 	   install -m 644 README.html Changelog.html $(DOC_DIR); \
 	   install $(PROGS) $(bindir); \
@@ -233,7 +233,7 @@
 	else \
 	   install -d $(DOC_DIR_i); \
 	   install -m 644 README.html Changelog.html $(DOC_DIR_i); \
-	   install -s $(PROGS) $(bindir); \
+	   install $(PROGS) $(bindir); \
 	   rm -f $(bindir)/trad2sim; ln -sf sim2trad $(bindir)/trad2sim; \
 	fi
 	$(MAKE) -C scripts install
diff -U 3 -H -b -w -B -E -d -i -r -N -- gcin-1.4.5.pre2.orig/Makefile.gcin gcin-1.4.5.pre2/Makefile.gcin
--- gcin-1.4.5.pre2.orig/Makefile.gcin	2009-02-28 15:43:27.000000000 +0800
+++ gcin-1.4.5.pre2/Makefile.gcin	2009-04-15 02:44:24.000000000 +0800
@@ -213,8 +213,8 @@
 	install $(GCIN_SO) $(gcinlibdir)
 
 install:
-	install -d $(datadir)/icons
-	install gcin.png $(datadir)/icons
+	install -d $(datadir)/pixmaps
+	install gcin.png $(datadir)/pixmaps
 	$(MAKE) -C icons install
 	install -d $(gcinlibdir)
 	install $(GCIN_SO) $(gcinlibdir)
@@ -225,7 +225,7 @@
 	if [ $(QT_IM) = 'Y' ]; then $(MAKE) -C qt-im install; fi
 	if [ $(QT4_IM) = 'Y' ]; then $(MAKE) -C qt4-im install; fi
 	if [ $(prefix) = /usr/local ]; then \
-	   install -m 644 gcin.png /usr/share/icons; \
+	   install -m 644 gcin.png /usr/share/pixmaps; \
 	   install -d $(DOC_DIR); \
 	   install -m 644 README.html Changelog.html $(DOC_DIR); \
 	   install $(PROGS) $(bindir); \
@@ -233,7 +233,7 @@
 	else \
 	   install -d $(DOC_DIR_i); \
 	   install -m 644 README.html Changelog.html $(DOC_DIR_i); \
-	   install -s $(PROGS) $(bindir); \
+	   install $(PROGS) $(bindir); \
 	   rm -f $(bindir)/trad2sim; ln -sf sim2trad $(bindir)/trad2sim; \
 	fi
 	$(MAKE) -C scripts install
diff -U 3 -H -b -w -B -E -d -i -r -N -- gcin-1.4.5.pre2.orig/qt4-im/Makefile gcin-1.4.5.pre2/qt4-im/Makefile
--- gcin-1.4.5.pre2.orig/qt4-im/Makefile	2009-01-27 19:42:40.000000000 +0800
+++ gcin-1.4.5.pre2/qt4-im/Makefile	2009-04-15 17:55:57.000000000 +0800
@@ -1,20 +1,16 @@
 include ../config.mak
 QT=qt4
-QTIM=$(QT)/plugins/lib/inputmethods
+QTIM=$(QT)/plugins/inputmethods
 IMMODULES=$(libdir)/$(QTIM)
-ifeq ($(LIB), lib64)
-	IMMODULES_LOCAL=/usr/$(LIB)/qt4/plugins/lib64/inputmethods
-else
-	IMMODULES_LOCAL=/usr/$(LIB)/$(QTIM)
-endif
-QTINC=/usr/lib/$(QT)/include
+IMMODULES_LOCAL=$(DESTDIR)/usr/local/$(LIB)/$(QTIM)
+QTINC=/usr/include/$(QT)
 
 INCS=-I../im-client -I$(QTINC) -I/usr/include/X11 -I$(QTINC)/QtGui -I$(QTINC)/QtCore
 CXXFLAGS=$(OPTFLAGS) $(INCS) -Wall -D_REENTRANT -fPIC  -DQT4 -DQT_SHARED \
 -DQT_IMMODULE -DPIC
 OBJS= moc_gcin-qt.o gcin-qt.o im-gcin-qt.o gcin-imcontext-qt.o
 .SUFFIXES:	.c .cpp .a .so .E .h
-LDFLAGS=-L/usr/lib/$(QT)/$(LIB) -L/usr/X11R6/$(LIB) -L../im-client -lQtGui -lQtCore -lmng -ljpeg -lpng -lz \
+LDFLAGS=-L/usr/$(LIB)/$(QT) -L/usr/include/xorg -L../im-client -lQtGui -lQtCore -lmng -ljpeg -lpng -lz \
 -lXrender -lXrandr  -lXft -lfontconfig -lgcin-im-client \
 -lXext -lX11 -lm -lSM -lICE -ldl -lpthread
 all:    im-gcin.so
@@ -23,7 +19,7 @@
 	$(CXX) -E $(CFLAGS) $(INCS) $< > $@
 
 moc_gcin-qt.cpp:	gcin-qt.h
-	/usr/lib/$(QT)/bin/moc $< -o moc_gcin-qt.cpp
+	/usr/bin/moc $< -o moc_gcin-qt.cpp
 
 im-gcin.so: $(OBJS)
 	export LD_RUN_PATH=$(gcinlibdir) ;\
