# Copyright 2009 Hong Hao <oahong@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require cmake flag-o-matic

SUMMARY="a portable, flexible file i/o abstraction library for video games"
HOMEPAGE="http://icculus.org/physfs"
DOWNLOADS="${HOMEPAGE}/downloads/${PNV}.tar.gz"

LICENCES="as-is LGPL-2.1 [[ description = [ for its internal copy of lzma ] ]]"
SLOT="0"
PLATFORMS="~x86"
MYOPTIONS="doc"

DEPENDENCIES="
    build:
        doc? ( app-doc/doxygen )
    build+run:
        sys-libs/zlib
"

UPSTREAM_CHANGELOG="${HOMEPAGE}/downloads/CHANGELOG"
UPSTREAM_REALEASE_NOTES="http://icculus.org/pipermail/physfs/2009-March/000697.html"

CMAKE_SRC_CONFIGURE_PARAMS=(
    -DPHYSFS_BUILD_TEST:BOOL=FALSE
    -DPHYSFS_BUILD_WX_TEST:BOOL=FALSE
)

pkg_setup() {
    append-flags "-fno-strict-aliasing"
}

src_compile() {
    cmake_src_compile
    if option doc ; then
        doxygen || die "doxygen failed"
    fi
}

src_install() {
    cmake_src_install
    if option doc ; then
        docinto html
        dodoc "${WORK}"/docs/html/*
    fi
}
